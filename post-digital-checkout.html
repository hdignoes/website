<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Building a Digital Fleet Checkout System — Hugo Dignoes Ricart</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* ── Article layout ── */
    .article-wrap {
      display: grid;
      grid-template-columns: 1fr 300px;
      gap: 2.5rem;
      align-items: start;
    }

    /* ── Article body ── */
    .article-body {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 3rem 3.2rem;
      box-shadow: var(--shadow-sm);
    }

    .article-meta {
      display: flex;
      align-items: center;
      gap: 1.2rem;
      font-size: .84rem;
      color: var(--light-muted);
      margin-bottom: 1.4rem;
      flex-wrap: wrap;
    }
    .article-meta span { display: flex; align-items: center; gap: .38rem; }

    .article-title {
      font-size: 2.1rem;
      font-weight: 800;
      color: var(--navy);
      line-height: 1.2;
      letter-spacing: -.025em;
      margin-bottom: .45rem;
    }

    .article-subtitle {
      font-size: 1.1rem;
      color: var(--muted);
      font-style: italic;
      margin-bottom: 1.6rem;
    }

    .article-tags { display: flex; gap: .5rem; flex-wrap: wrap; margin-bottom: 2rem; }

    .article-divider {
      border: none;
      border-top: 2px solid var(--border);
      margin: 2rem 0;
    }

    /* ── Article prose ── */
    .article-content h2 {
      font-size: 1.4rem;
      font-weight: 800;
      color: var(--navy);
      margin: 2.2rem 0 .7rem;
    }
    .article-content h3 {
      font-size: 1.1rem;
      font-weight: 700;
      color: var(--navy);
      margin: 1.6rem 0 .5rem;
    }
    .article-content p { margin-bottom: 1.1rem; line-height: 1.8; color: var(--muted); }
    .article-content ul, .article-content ol {
      margin: .8rem 0 1.1rem 1.5rem;
      color: var(--muted);
      line-height: 1.8;
    }
    .article-content li { margin-bottom: .3rem; }
    .article-content strong { color: var(--navy); }
    .article-content code {
      font-family: 'Courier New', monospace;
      background: #eef2f6;
      padding: .15rem .4rem;
      border-radius: 4px;
      font-size: .88em;
      color: #c7254e;
    }
    .article-content pre {
      background: #1a2535;
      color: #cdd6f4;
      border-radius: var(--radius-lg);
      padding: 1.4rem 1.6rem;
      overflow-x: auto;
      font-size: .87rem;
      line-height: 1.6;
      margin: 1.2rem 0 1.5rem;
    }
    .article-content pre code {
      background: none;
      padding: 0;
      color: inherit;
      font-size: inherit;
    }
    .article-content a { color: var(--blue-light); }
    .article-content a:hover { text-decoration: underline; }

    /* ── Callout boxes ── */
    .callout {
      background: #f0f7ff;
      border-left: 4px solid var(--blue-light);
      border-radius: 0 var(--radius) var(--radius) 0;
      padding: 1rem 1.3rem;
      margin: 1.4rem 0;
      font-size: .93rem;
      color: var(--muted);
      line-height: 1.7;
    }
    .callout-title {
      font-weight: 700;
      color: var(--navy);
      margin-bottom: .4rem;
      font-size: .9rem;
    }
    .callout-teal {
      background: #f0faf7;
      border-left-color: var(--teal);
    }

    /* ── Architecture diagram box ── */
    .arch-box {
      background: #f7f9fc;
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.5rem 1.8rem;
      margin: 1.5rem 0;
      font-size: .88rem;
      font-family: 'Courier New', monospace;
      color: var(--navy);
      line-height: 1.9;
    }
    .arch-box .arch-label {
      font-family: inherit;
      font-size: .75rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .06em;
      color: var(--teal);
      margin-bottom: .6rem;
      font-family: var(--font);
    }

    /* ── Sidebar ── */
    .article-sidebar { display: flex; flex-direction: column; gap: 1.4rem; position: sticky; top: 5.5rem; }

    .sidebar-widget {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.4rem 1.5rem;
      box-shadow: var(--shadow-sm);
    }

    .sidebar-widget-title {
      font-size: .72rem;
      font-weight: 800;
      text-transform: uppercase;
      letter-spacing: .09em;
      color: var(--teal);
      margin-bottom: .9rem;
    }

    /* Author */
    .author-card { display: flex; align-items: center; gap: .9rem; }
    .author-avatar {
      width: 48px; height: 48px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
    }
    .author-avatar-fallback {
      width: 48px; height: 48px;
      border-radius: 50%;
      background: var(--blue-light);
      display: flex; align-items: center; justify-content: center;
      color: #fff; font-size: 1.2rem;
    }
    .author-name { font-weight: 700; font-size: .92rem; color: var(--navy); }
    .author-role { font-size: .8rem; color: var(--muted); margin-top: .15rem; }

    /* TOC */
    .toc-list { list-style: none; padding: 0; display: flex; flex-direction: column; gap: .4rem; }
    .toc-list a {
      font-size: .85rem;
      color: var(--muted);
      text-decoration: none;
      display: block;
      padding: .25rem .5rem;
      border-radius: 4px;
      transition: background var(--transition), color var(--transition);
    }
    .toc-list a:hover { background: #f0f7ff; color: var(--blue-light); }

    /* Related links */
    .related-link {
      display: flex; align-items: flex-start; gap: .8rem;
      padding: .7rem;
      border-radius: var(--radius);
      text-decoration: none;
      transition: background var(--transition);
      color: var(--navy);
    }
    .related-link:hover { background: #f0f7ff; }
    .related-link > i { color: var(--teal); margin-top: .15rem; flex-shrink: 0; }
    .related-link-title { font-size: .87rem; font-weight: 600; color: var(--navy); }
    .related-link-meta  { font-size: .78rem; color: var(--muted); margin-top: .1rem; }

    /* Breadcrumb */
    .breadcrumb {
      display: flex; align-items: center; gap: .5rem;
      font-size: .83rem; color: var(--muted);
      margin-bottom: 1.8rem;
    }
    .breadcrumb a { color: var(--blue-light); }
    .breadcrumb i { font-size: .65rem; color: var(--light-muted); }

    /* Tech stack chips */
    .stack-chips { display: flex; flex-wrap: wrap; gap: .4rem; margin: .6rem 0 1rem; }
    .stack-chip {
      display: inline-flex; align-items: center; gap: .35rem;
      font-size: .78rem; font-weight: 600;
      background: #eef2f6; color: var(--navy);
      border: 1px solid var(--border);
      border-radius: 20px; padding: .2rem .7rem;
    }
    .stack-chip i { color: var(--teal); }

    @media (max-width: 900px) {
      .article-wrap { grid-template-columns: 1fr; }
      .article-sidebar { position: static; }
      .article-body { padding: 2rem 1.5rem; }
    }
  </style>
</head>
<body>

<!-- ── NAV ──────────────────────────────────────────────────────── -->
<nav>
  <div class="nav-inner">
    <a href="index.html" style="text-decoration:none">
      <div class="nav-brand">
        <span class="nav-brand-name">Hugo Dignoes Ricart</span>
        <span class="nav-brand-role">PhD Student · Mechanical Engineering · UBC</span>
      </div>
    </a>
    <ul class="nav-menu">
      <li><a href="index.html">About</a></li>
      <li><a href="experience.html">Experience</a></li>
      <li><a href="projects.html">Projects</a></li>
      <li><a href="blog.html" class="active">Blog</a></li>
      <li><a href="contact.html">Contact</a></li>
    </ul>
  </div>
</nav>

<!-- ── ARTICLE ───────────────────────────────────────────────────── -->
<section class="section" style="background: var(--bg); padding-top: 2.5rem;">
  <div class="container">

    <!-- Breadcrumb -->
    <nav class="breadcrumb" aria-label="Breadcrumb">
      <a href="index.html">Home</a>
      <i class="fa-solid fa-chevron-right"></i>
      <a href="blog.html">Blog</a>
      <i class="fa-solid fa-chevron-right"></i>
      <span style="color: var(--navy);">Building a Digital Fleet Checkout System</span>
    </nav>

    <div class="article-wrap">

      <!-- ── Main article ── -->
      <main>
        <article class="article-body">

          <div class="article-meta">
            <span><i class="fa-solid fa-calendar-days"></i> February 2025</span>
            <span><i class="fa-regular fa-clock"></i> ~10 min read</span>
            <span><i class="fa-solid fa-user"></i> Hugo Dignoes Ricart</span>
          </div>

          <h1 class="article-title">Building a Digital Fleet Checkout System for a University Sailing Club</h1>
          <p class="article-subtitle">How I replaced a paper logbook with an NFC kiosk, a FastAPI backend, and a lot of Kotlin</p>

          <div class="article-tags">
            <span class="tag">Software</span>
            <span class="tag">Android</span>
            <span class="tag">Python</span>
            <span class="tag">Sailing Club</span>
            <span class="tag">Engineering</span>
          </div>

          <hr class="article-divider" />

          <div class="article-content">

            <h2>The problem with paper</h2>

            <p>
              When I became president of the <strong>UBC Sailing Club</strong> in October 2024, one of the
              first things I noticed was how we tracked our fleet. Members wanting to take out a boat
              would walk up to the dock shack, find a paper logbook, write their name, the boat name,
              the time, and their expected return. When they came back, they'd fill in the check-in time.
              If anyone damaged something, they'd (hopefully) note it down.
            </p>

            <p>
              For a club managing over <strong>$400,000 in assets</strong> and dozens of vessels — from
              Lasers and FJs to Hobie cats and keelboats — this system had some obvious problems:
            </p>

            <ul>
              <li>No way to verify that a member was actually certified for the boat they wanted to take.</li>
              <li>No real-time visibility into which boats were out — you had to walk to the dock or flip through the log.</li>
              <li>Double-checkouts were possible if two people wrote in the book at the same time.</li>
              <li>Data was trapped in a physical binder. Generating any kind of usage report required manual transcription.</li>
              <li>Damage reports were easy to skip, especially when members were in a hurry.</li>
            </ul>

            <div class="callout">
              <div class="callout-title"><i class="fa-solid fa-lightbulb"></i> &ensp;The goal</div>
              Replace the paper logbook with a self-service kiosk that verifies certifications, prevents
              conflicts, forces a damage report on check-in, and logs everything automatically — without
              requiring a staff member to be present.
            </div>

            <h2>System architecture</h2>

            <p>
              The system has two components: an <strong>Android kiosk app</strong> deployed on a tablet at
              the dock, and a <strong>FastAPI backend</strong> running on a server that the app talks to.
            </p>

            <div class="arch-box">
              <div class="arch-label">System Overview</div>
              ┌─────────────────────────────┐<br>
              │  Android Kiosk (Tablet)     │  NFC card scan or USB RFID reader<br>
              │  Kotlin + Jetpack Compose   │  → member lookup → cert check<br>
              └────────────┬────────────────┘<br>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;│  REST API (KIOSK_API_KEY)<br>
              ┌────────────▼────────────────┐<br>
              │  FastAPI Backend (Python)   │  ← Wild Apricot sync (6h)<br>
              │  SQLite / PostgreSQL        │  → Google Sheets webhook<br>
              └─────────────────────────────┘
            </div>

            <p>
              The backend manages the source of truth: members, their certifications, the fleet inventory,
              and active checkout sessions. The kiosk app is intentionally thin — it handles the UI and
              NFC reading, but all business logic (certification validation, conflict prevention, session
              management) lives in the API.
            </p>

            <h2>The tech stack</h2>

            <div class="stack-chips">
              <span class="stack-chip"><i class="fa-brands fa-python"></i> Python / FastAPI</span>
              <span class="stack-chip"><i class="fa-solid fa-database"></i> SQLite / PostgreSQL</span>
              <span class="stack-chip"><i class="fa-brands fa-android"></i> Kotlin / Jetpack Compose</span>
              <span class="stack-chip"><i class="fa-solid fa-wifi"></i> NFC + USB HID</span>
              <span class="stack-chip"><i class="fa-solid fa-sheet-plastic"></i> Google Sheets</span>
              <span class="stack-chip"><i class="fa-solid fa-users"></i> Wild Apricot</span>
            </div>

            <h3>Backend: FastAPI + SQLAlchemy</h3>

            <p>
              I chose FastAPI for the backend for a few reasons: async support out of the box, automatic
              OpenAPI docs (incredibly useful when debugging from the Android side), and Pydantic for
              request/response validation. The schema is simple — five tables covering members, NFC cards,
              craft, checkout sessions, and crew members — managed with Alembic migrations so updates
              are versioned and reproducible.
            </p>

            <p>
              The backend also runs a background scheduler (APScheduler) that does two things automatically:
              syncs member data from Wild Apricot every six hours, and auto-expires sessions that are
              significantly past their expected return time. Both jobs run as daemon threads so they never
              block API responses.
            </p>

            <h3>Android app: Kotlin + Jetpack Compose</h3>

            <p>
              The kiosk app is a single-activity Android app built entirely with Jetpack Compose. Navigation
              is driven by a state machine in a shared <code>CheckoutViewModel</code> — the UI observes
              a <code>StateFlow</code> and renders whichever screen matches the current state:
            </p>

            <ul>
              <li><strong>Idle</strong> — welcome screen; auto-resets after 60 seconds of inactivity</li>
              <li><strong>Member found</strong> — shows name, offers checkout or check-in options</li>
              <li><strong>Select craft class</strong> — only shows classes the member is certified for</li>
              <li><strong>Select specific boat</strong> — only shows available boats in that class</li>
              <li><strong>Add crew</strong> — optional; crew can be added by card scan, name, or as guests</li>
              <li><strong>Confirm checkout</strong> — shows full summary before committing</li>
              <li><strong>Damage report</strong> — required on every check-in</li>
              <li><strong>Result</strong> — success or error feedback before returning to idle</li>
            </ul>

            <div class="callout callout-teal">
              <div class="callout-title"><i class="fa-solid fa-lock"></i> &ensp;Kiosk lockdown</div>
              The app uses Android's <strong>Lock Task Mode</strong> (Device Admin API) to prevent members
              from switching apps or accessing the device settings. Setup is a one-time ADB command to
              set the app as device owner. After that, the tablet is a single-purpose kiosk.
            </div>

            <h2>NFC card scanning</h2>

            <p>
              Member identification is the core interaction of the whole system. I evaluated a few approaches:
            </p>

            <ul>
              <li>Manual entry (name or member number) — slow and error-prone</li>
              <li>QR code scanning — requires phone camera or dedicated scanner; cards wear out</li>
              <li><strong>NFC card tap</strong> — fast, reliable, already familiar from transit cards</li>
            </ul>

            <p>
              NFC won. The app reads the UID from any compatible NFC tag or card (MIFARE, ISO 14443-A/B),
              normalizes it to uppercase hex, and sends it to the backend for lookup. To support older
              RFID-only setups (USB HID keyboard-emulating readers), the app also accepts UIDs typed as
              keystrokes — intercepted at the Activity level before they reach any text field.
            </p>

            <p>
              Members register their card once (at the dock or by an admin), after which every tap
              is a sub-second lookup. The normalization step is important: different readers report
              the same card UID in different byte orders or cases, so the backend canonicalizes
              everything on write and on read.
            </p>

            <h2>Wild Apricot integration</h2>

            <p>
              UBC Sailing Club uses <strong>Wild Apricot</strong> as its membership management platform.
              Rather than maintaining a separate member database, the backend syncs member records
              every six hours via Wild Apricot's OAuth API. Name, email, membership status, and
              a JSON-encoded list of certifications are pulled and stored locally.
            </p>

            <p>
              Certifications are stored as a simple list — e.g. <code>["Laser", "RS Quest", "FJ"]</code>
              — and the <code>"*"</code> wildcard is used for executives and instructors who can take out
              any boat. The Android app requests the fleet filtered to only the classes a member is
              authorized for, so members never even see boats they can't check out.
            </p>

            <h2>Logging to Google Sheets</h2>

            <p>
              The club's existing workflows already revolved around Google Sheets for reporting. Rather
              than build a custom admin dashboard for usage analytics, I wrote a Google Apps Script
              webhook that the backend calls on every checkout and check-in event. The webhook appends
              a row with timestamp, member name, craft, party size, expected return time, duration,
              and a damage flag.
            </p>

            <p>
              The webhook call is fire-and-forget — the API submits a response to the kiosk immediately
              and the sheet update happens in a daemon thread. If the webhook fails, the local database
              record is the source of truth and the sheet can be backfilled later.
            </p>

            <h2>What I would do differently</h2>

            <p>
              A few things I underestimated going in:
            </p>

            <ul>
              <li>
                <strong>Edge cases in checkout logic.</strong> A member checking in a boat they didn't
                check out (e.g. their crewmate did the checkout) required more careful session-linking
                logic than I anticipated. The "check in for someone else" flow ended up being one of the
                more complex UI paths.
              </li>
              <li>
                <strong>Android device management.</strong> Getting Lock Task Mode set up correctly took
                longer than expected. The Device Admin receiver, device owner provisioning via ADB, and
                making sure the app survives restarts in kiosk mode involved a lot of trial and error on
                the physical tablet.
              </li>
              <li>
                <strong>SQLite vs PostgreSQL.</strong> I started with SQLite for simplicity during
                development, which worked perfectly — but BigInt primary keys behave differently in
                SQLite vs PostgreSQL, which caused a migration fix mid-way through. Using PostgreSQL
                from the start would have caught this earlier.
              </li>
            </ul>

            <h2>Current status</h2>

            <p>
              The system is deployed and in use at the UBC Sailing Club dock. The backend runs on a
              university server; the kiosk tablet is mounted at the check-in station. Wild Apricot
              sync keeps member certifications up to date automatically, and checkout logs flow into
              the club's existing Google Sheets reporting system.
            </p>

            <p>
              The source code is open on GitHub under the UBC Sailing Club organization. Contributions
              and forks are welcome — this kind of system is useful for any club or organization managing
              a shared fleet of equipment.
            </p>

          </div><!-- /.article-content -->

          <hr class="article-divider" />

          <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap;">
            <a href="blog.html" class="btn btn-outline" style="font-size:.85rem">
              <i class="fa-solid fa-arrow-left"></i> Back to Blog
            </a>
            <a href="https://github.com/ubcsailingclub/digital_checkout" target="_blank" rel="noopener"
               class="btn btn-primary" style="font-size:.85rem">
              <i class="fa-brands fa-github"></i> View on GitHub
            </a>
            <a href="projects.html" class="btn btn-teal" style="font-size:.85rem">
              <i class="fa-solid fa-diagram-project"></i> See the Project
            </a>
          </div>

        </article>
      </main>

      <!-- ── Sidebar ── -->
      <aside class="article-sidebar">

        <!-- Author -->
        <div class="sidebar-widget">
          <div class="sidebar-widget-title">Author</div>
          <div class="author-card">
            <img
              src="assets/profile_pic.jpg"
              alt="Hugo Dignoes Ricart"
              class="author-avatar"
              onerror="this.outerHTML='<div class=\'author-avatar-fallback\'><i class=\'fa-solid fa-user\'></i></div>'"
            />
            <div>
              <div class="author-name">Hugo Dignoes Ricart</div>
              <div class="author-role">Mechanical Engineering, UBC</div>
            </div>
          </div>
        </div>

        <!-- Table of contents -->
        <div class="sidebar-widget">
          <div class="sidebar-widget-title">Contents</div>
          <ul class="toc-list">
            <li><a href="#">The problem with paper</a></li>
            <li><a href="#">System architecture</a></li>
            <li><a href="#">The tech stack</a></li>
            <li><a href="#">NFC card scanning</a></li>
            <li><a href="#">Wild Apricot integration</a></li>
            <li><a href="#">Logging to Google Sheets</a></li>
            <li><a href="#">What I'd do differently</a></li>
            <li><a href="#">Current status</a></li>
          </ul>
        </div>

        <!-- Related -->
        <div class="sidebar-widget">
          <div class="sidebar-widget-title">Related</div>

          <a href="projects.html" class="related-link">
            <i class="fa-solid fa-diagram-project"></i>
            <div>
              <div class="related-link-title">UBCSC Digital Checkout</div>
              <div class="related-link-meta">Project overview</div>
            </div>
          </a>

          <a href="https://github.com/ubcsailingclub/digital_checkout" target="_blank" rel="noopener"
             class="related-link">
            <i class="fa-brands fa-github"></i>
            <div>
              <div class="related-link-title">Source Code</div>
              <div class="related-link-meta">github.com/ubcsailingclub</div>
            </div>
          </a>

          <a href="contact.html" class="related-link">
            <i class="fa-solid fa-envelope"></i>
            <div>
              <div class="related-link-title">Get in touch</div>
              <div class="related-link-meta">Questions or collaborations</div>
            </div>
          </a>
        </div>

      </aside><!-- /.article-sidebar -->

    </div><!-- /.article-wrap -->
  </div><!-- /.container -->
</section>

<!-- ── FOOTER ────────────────────────────────────────────────────── -->
<footer id="site-footer"></footer>

<!-- ── CONTENT DATA ──────────────────────────────────────────────── -->
<script src="content/profile.js"></script>

<!-- ── RENDER ────────────────────────────────────────────────────── -->
<script>
(function () {
  document.getElementById('site-footer').innerHTML =
    `<p>&copy; ${new Date().getFullYear()} ${PROFILE.name} &nbsp;·&nbsp; ${PROFILE.location} &nbsp;·&nbsp;
      <a href="mailto:${PROFILE.email}">${PROFILE.email}</a></p>`;
})();
</script>

</body>
</html>
